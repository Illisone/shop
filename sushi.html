<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="style_sushi.css">
</head>
<body>

<div class="header">
    <div class="brand">
        <div class="logo-circle" style="color:white">Y</div>
        <div style="font-weight:900; font-size:20px; letter-spacing:-0.5px">YAKUZA</div>
    </div>
    <div style="display:flex; gap:12px; align-items:center;">
        <div class="cart-btn" onclick="openCart()" style="position:relative; cursor:pointer; background:rgba(255,255,255,0.08); width:44px; height:44px; border-radius:50%; display:flex; align-items:center; justify-content:center;">
            <span style="font-size:20px;">üõí</span>
            <div id="c-count" style="position:absolute; top:-2px; right:-2px; background:var(--accent); color:white; font-size:10px; width:18px; height:18px; border-radius:50%; display:none; align-items:center; justify-content:center; font-weight:800; border:2px solid #000;">0</div>
        </div>
        <img id="u-avatar" style="width:38px; height:38px; border-radius:50%; border:1px solid var(--glass-border); object-fit:cover" src="https://via.placeholder.com/38">
    </div>
</div>

<div class="main-content">
    <div class="promo-container">
        <div class="promo-card">
            <h4 style="margin:0; font-size:22px">–°–∫–∏–¥–∫–∞ -20%</h4>
            <p style="margin:8px 0; opacity:0.9">–ù–∞ –≤–∞—à –ø–µ—Ä–≤—ã–π –∑–∞–∫–∞–∑<br>—á–µ—Ä–µ–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ!</p>
            <span style="font-size:50px; position:absolute; right:15px; bottom:10px; filter: drop-shadow(0 5px 10px rgba(0,0,0,0.2))">üç£</span>
        </div>
        <div class="promo-card dark">
            <h4 style="margin:0; font-size:22px">–ö–æ–º–±–æ-–î–Ω–∏</h4>
            <p style="margin:8px 0; opacity:0.7">–î–≤–µ ¬´–ö–∞–ª–∏—Ñ–æ—Ä–Ω–∏–∏¬ª –ø–æ<br>—Ü–µ–Ω–µ –æ–¥–Ω–æ–π!</p>
            <span style="font-size:50px; position:absolute; right:15px; bottom:10px">üéÅ</span>
        </div>
    </div>

    <h3 style="margin:10px 20px 15px; font-weight:800; font-size:24px;">–í—ã–±–∏—Ä–∞–π—Ç–µ –ª—É—á—à–µ–µ</h3>
    <div class="grid" id="grid"></div>
</div>

<div class="tab-bar">
    <div class="tab-item active" onclick="setCat('all', this)">–í—Å–µ</div>
    <div class="tab-item" onclick="setCat('rolls', this)">–†–æ–ª–ª—ã</div>
    <div class="tab-item" onclick="setCat('sets', this)">–°–µ—Ç—ã</div>
</div>

<div class="overlay" id="overlay" onclick="closeAll()"></div>

<div id="details-sheet" class="sheet">
    <div style="width:40px; height:5px; background:rgba(255,255,255,0.2); border-radius:10px; margin: 0 auto 20px;"></div>
    <img id="d-img" style="width:100%; border-radius:24px; max-height:280px; object-fit:cover;">
    
    <div style="display:flex; justify-content:space-between; align-items:center; margin:25px 0 10px;">
        <h2 id="d-title" style="margin:0; font-size:28px; font-weight:800;"></h2>
        <span id="d-price-big" style="color:var(--accent); font-weight:900; font-size:28px;"></span>
    </div>
    
    <div id="d-meta" style="color:var(--gray); font-size:15px; font-weight:600; margin-bottom:15px;"></div>
    <p id="d-desc" style="color:#bbb; line-height:1.6; font-size:16px; margin:0; padding-bottom:10px;"></p>
    
    <button class="btn-order" onclick="addToCart()">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
</div>

<div id="cart-sheet" class="sheet">
    <div style="width:40px; height:5px; background:rgba(255,255,255,0.2); border-radius:10px; margin: 0 auto 20px;"></div>
    <h2 style="margin:0 0 20px; font-size:28px">–ö–æ—Ä–∑–∏–Ω–∞</h2>
    <div id="cart-items"></div>
    
    <div id="order-form" style="display:none; margin-top:20px;">
        <input type="text" id="address" placeholder="–ö—É–¥–∞ –¥–æ—Å—Ç–∞–≤–∏—Ç—å?" style="width:100%; background:rgba(255,255,255,0.06); border:1px solid var(--glass-border); padding:20px; border-radius:20px; color:white; font-size:16px; box-sizing:border-box; outline:none;">
        <button class="btn-order" onclick="sendOrder()">–ó–∞–∫–∞–∑–∞—Ç—å ‚Ä¢ <span id="total-val">0</span>‚ÇΩ</button>
    </div>
</div>

<script>
    let tg = window.Telegram.WebApp;
    tg.expand();

    let cart = [];
    let curProduct = null;
    let currentCategory = 'all';

    const products = [
        {id:1, cat:'rolls', name:"–§–∏–ª–∞–¥–µ–ª—å—Ñ–∏—è", price:890, meta:"280–≥ ‚Ä¢ 8 —à—Ç", img:"https://images.unsplash.com/photo-1579871494447-9811cf80d66c?w=600", desc:"–ù–∞—à –±–µ—Å—Ç—Å–µ–ª–ª–µ—Ä! –ù–µ–∂–Ω–µ–π—à–∏–π –ª–æ—Å–æ—Å—å —Å–ª–∞–±–æ–π —Å–æ–ª–∏, —Å–ª–∏–≤–æ—á–Ω—ã–π —Å—ã—Ä –∏ —Å–ø–µ–ª—ã–π –∞–≤–æ–∫–∞–¥–æ –≤ —Å–æ—á–µ—Ç–∞–Ω–∏–∏ —Å —Ä–∏—Å–æ–º –≤—ã—Å—à–µ–≥–æ —Å–æ—Ä—Ç–∞."},
        {id:2, cat:'rolls', name:"–ö–∞–ª–∏—Ñ–æ—Ä–Ω–∏—è", price:750, meta:"250–≥ ‚Ä¢ 8 —à—Ç", img:"https://images.unsplash.com/photo-1559466273-d95e72debaf8?w=600", desc:"–ö–ª–∞—Å—Å–∏–∫–∞ —Å –∏–∑—é–º–∏–Ω–∫–æ–π: —Å–Ω–µ–∂–Ω—ã–π –∫—Ä–∞–±, —Ñ–∏—Ä–º–µ–Ω–Ω—ã–π —è–ø–æ–Ω—Å–∫–∏–π –º–∞–π–æ–Ω–µ–∑, —Å–≤–µ–∂–∏–π –æ–≥—É—Ä–µ—Ü –∏ —è—Ä–∫–∞—è –∏–∫—Ä–∞ —Ç–æ–±–∏–∫–æ."},
        {id:4, cat:'sets', name:"–°–µ—Ç –Ø–∫—É–¥–∑–∞", price:4500, meta:"1.2–∫–≥ ‚Ä¢ 40 —à—Ç", img:"https://images.unsplash.com/photo-1583623025817-d180a2221d0a?w=600", desc:"–î–ª—è —Ç–µ—Ö, –∫—Ç–æ —Ö–æ—á–µ—Ç –≤—Å—ë –∏ —Å—Ä–∞–∑—É! –í–∫–ª—é—á–∞–µ—Ç –§–∏–ª–∞–¥–µ–ª—å—Ñ–∏—é, –ö–∞–ª–∏—Ñ–æ—Ä–Ω–∏—é, –¥–≤–∞ –∑–∞–ø–µ—á–µ–Ω–Ω—ã—Ö —Ä–æ–ª–ª–∞ –∏ –ø–æ—Ä—Ü–∏—é –≥—É–Ω–∫–∞–Ω–æ–≤."}
    ];

    function render() {
        const grid = document.getElementById('grid');
        grid.innerHTML = products.filter(p => currentCategory === 'all' || p.cat === currentCategory).map(p => `
            <div class="item" onclick="showItem(${p.id})">
                <img src="${p.img}" class="item-img">
                <div style="font-weight:700; font-size:16px;">${p.name}</div>
                <div style="font-size:11px; color:var(--gray); margin: 6px 0 10px;">${p.meta}</div>
                <div style="font-weight:800; color:var(--accent); display:flex; justify-content:space-between; align-items:center;">
                    ${p.price} ‚ÇΩ <div style="background:var(--accent); color:white; width:24px; height:24px; border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:18px">+</div>
                </div>
            </div>`).join('');
    }

    function showItem(id) {
        curProduct = products.find(p => p.id === id);
        document.getElementById('d-img').src = curProduct.img;
        document.getElementById('d-title').innerText = curProduct.name;
        document.getElementById('d-meta').innerText = curProduct.meta;
        document.getElementById('d-desc').innerText = curProduct.desc;
        document.getElementById('d-price-big').innerText = curProduct.price + ' ‚ÇΩ';
        
        document.getElementById('details-sheet').classList.add('active');
        document.getElementById('overlay').classList.add('active');
        tg.HapticFeedback.impactOccurred('medium');
    }

    function addToCart() {
        cart.push(curProduct);
        updateCart();
        closeAll();
        tg.HapticFeedback.notificationOccurred('success');
    }

    function updateCart() {
        document.getElementById('c-count').innerText = cart.length;
        document.getElementById('c-count').style.display = cart.length > 0 ? 'flex' : 'none';
        document.getElementById('total-val').innerText = cart.reduce((s, i) => s + i.price, 0);
        document.getElementById('order-form').style.display = cart.length > 0 ? 'block' : 'none';
    }

    function openCart() {
        const list = document.getElementById('cart-items');
        list.innerHTML = cart.length === 0 ? '<p style="text-align:center;color:var(--gray);padding:30px;">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞. –í—Ä–µ–º—è –¥–æ–±–∞–≤–∏—Ç—å —Ä–æ–ª–ª—ã!</p>' : 
            cart.map((i, idx) => `
            <div style="display:flex; justify-content:space-between; padding:16px; background:rgba(255,255,255,0.04); border-radius:20px; margin-bottom:10px; border:1px solid var(--glass-border)">
                <div><b style="font-size:16px">${i.name}</b><br><small style="color:var(--gray)">${i.price} ‚ÇΩ</small></div>
                <div style="color:var(--accent); font-weight:700; font-size:14px;" onclick="cart.splice(${idx},1); updateCart(); openCart();">–£–¥–∞–ª–∏—Ç—å</div>
            </div>`).join('');
        document.getElementById('cart-sheet').classList.add('active');
        document.getElementById('overlay').classList.add('active');
    }

    function closeAll() {
        document.querySelectorAll('.sheet').forEach(s => s.classList.remove('active'));
        document.getElementById('overlay').classList.remove('active');
    }

    function setCat(cat, el) {
        currentCategory = cat;
        document.querySelectorAll('.tab-item').forEach(i => i.classList.remove('active'));
        el.classList.add('active');
        render();
        tg.HapticFeedback.impactOccurred('light');
    }

    if(tg.initDataUnsafe?.user?.photo_url) document.getElementById('u-avatar').src = tg.initDataUnsafe.user.photo_url;
    render();
</script>
</body>
</html>