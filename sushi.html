<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="style_sushi.css">
    <title>Yakuza Sushi</title>
    <style>
        /* –î–æ–±–∞–≤–æ—á–Ω—ã–µ —Å—Ç–∏–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥–ª–∏ –ø–æ—Ç–µ—Ä—è—Ç—å—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–Ω–æ—Å–µ */
        .user-block { display: flex; align-items: center; gap: 10px; }
        .avatar-img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; }
        .brand { display: flex; align-items: center; gap: 10px; }
        
        .promo-card {
            background: var(--card);
            border-radius: 22px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid var(--border-color);
        }

        .add-badge {
            background: var(--accent);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .overlay {
            position: fixed; inset: 0;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
            opacity: 0; visibility: hidden;
            transition: 0.3s; z-index: 1500;
        }
        .overlay.active { opacity: 1; visibility: visible; }

        .cart-item { border-bottom: 1px solid var(--border-color) !important; }
    </style>
</head>
<body>

<div class="header">
    <div class="brand">
        <div class="logo-circle">Y</div>
        <div style="font-weight: 800; font-size: 18px; letter-spacing: -0.5px;">YAKUZA</div>
    </div>
    <div class="user-block">
        <div onclick="openCart()" style="position: relative; cursor: pointer;">
            <span style="font-size: 26px;">üõí</span>
            <div id="c-count" style="position:absolute; top:-4px; right:-4px; background:var(--accent); color:white; font-size:10px; width:18px; height:18px; border-radius:50%; display:none; align-items:center; justify-content:center; font-weight:800; border: 2px solid var(--bg);">0</div>
        </div>
        <div class="avatar-wrap">
            <img id="u-avatar" class="avatar-img" src="https://via.placeholder.com/38">
        </div>
        <span id="user-name" style="font-weight: 700; font-size: 14px; margin-left: -5px;"></span>
    </div>
</div>

<div class="main-content" style="padding-bottom: 120px;">
    <div id="home-view">
        <h3 style="margin: 20px;">–ê–∫—Ü–∏–∏</h3>
        <div class="promo-card" style="margin: 0 20px 20px;">
            <div class="text">
                <h4 style="margin:0; color:var(--accent);">NEWBIE</h4>
                <p style="margin:5px 0 0; font-size:12px; color:var(--gray);">-15% –Ω–∞ –ø–µ—Ä–≤—ã–π –∑–∞–∫–∞–∑</p>
            </div>
            <img src="https://images.unsplash.com/photo-1596472464190-2e92c2a014a4?w=200" style="width:60px; height:60px; border-radius:12px; object-fit:cover;">
        </div>
        
        <h3 style="margin: 20px;">–ú–µ–Ω—é</h3>
        <div class="grid" id="grid"></div>
    </div>
</div>

<div class="tab-bar">
    <div class="tab-item active" onclick="setCat('all', this)">–í—Å–µ</div>
    <div class="tab-item" onclick="setCat('rolls', this)">–†–æ–ª–ª—ã</div>
    <div class="tab-item" onclick="setCat('sets', this)">–°–µ—Ç—ã</div>
    <div class="tab-item" onclick="setCat('drinks', this)">–ù–∞–ø–∏—Ç–∫–∏</div>
</div>

<div class="overlay" id="overlay" onclick="closeAll()"></div>

<div id="details-sheet" class="sheet">
    <div style="width: 40px; height: 4px; background: #333; border-radius: 2px; margin: -10px auto 20px;"></div>
    <img id="d-img" style="width:100%; border-radius:30px; height:240px; object-fit:cover;">
    <div style="display:flex; justify-content:space-between; align-items:start; margin:20px 0 10px;">
        <h2 id="d-title" style="margin:0; font-size: 24px;"></h2>
        <span id="d-price-big" style="font-size: 24px; font-weight: 800; color: var(--accent);"></span>
    </div>
    <div style="color: var(--gray); font-size: 12px; margin-bottom: 15px;" id="d-meta"></div>
    <p id="d-desc" style="color:#aaa; font-size:15px; line-height:1.6;"></p>
    <button class="btn-order" onclick="addToCart()">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
</div>

<div id="cart-sheet" class="sheet">
    <div style="width: 40px; height: 4px; background: #333; border-radius: 2px; margin: -10px auto 20px;"></div>
    <h2 style="margin-top:0">–ö–æ—Ä–∑–∏–Ω–∞</h2>
    <div id="cart-items"></div>
    
    <p style="font-size:12px; font-weight:700; margin:20px 0 10px; color:var(--gray);">–î–û–ë–ê–í–ò–¢–¨ –ö –ó–ê–ö–ê–ó–£?</p>
    <div style="display:flex; gap:10px; overflow-x:auto; padding-bottom:10px;">
        <div onclick="addAddon('–ü–∞–ª–æ—á–∫–∏', 0, 'ü•¢')" style="background:var(--card); padding:10px; border-radius:15px; min-width:80px; text-align:center; font-size:12px; border: 1px solid var(--border-color);">ü•¢<br>0‚ÇΩ</div>
        <div onclick="addAddon('–ò–º–±–∏—Ä—å', 45, 'üíÆ')" style="background:var(--card); padding:10px; border-radius:15px; min-width:80px; text-align:center; font-size:12px; border: 1px solid var(--border-color);">üíÆ<br>45‚ÇΩ</div>
        <div onclick="addAddon('–í–∞—Å–∞–±–∏', 45, 'üåø')" style="background:var(--card); padding:10px; border-radius:15px; min-width:80px; text-align:center; font-size:12px; border: 1px solid var(--border-color);">üåø<br>45‚ÇΩ</div>
    </div>

    <input type="text" id="address" style="width:100%; background:var(--glass); border:1px solid #333; padding:15px; border-radius:18px; color:white; margin:15px 0; box-sizing:border-box;" placeholder="–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏">
    <button class="btn-order" onclick="sendOrder()">–ó–∞–∫–∞–∑–∞—Ç—å ‚Ä¢ <span id="total-val">0</span>‚ÇΩ</button>
</div>

<script>
    let tg = window.Telegram.WebApp;
    tg.expand();
    tg.ready();

    let cart = [];
    let curProduct = null;
    let currentCategory = 'all';

    const products = [
        {id:1, cat:'rolls', name:"–§–∏–ª–∞–¥–µ–ª—å—Ñ–∏—è", price:890, meta:"280–≥ ‚Ä¢ 8—à—Ç", img:"https://images.unsplash.com/photo-1579871494447-9811cf80d66c?w=500", desc:"–ö–ª–∞—Å—Å–∏–∫–∞ —Å –ø—Ä–µ–º–∏–∞–ª—å–Ω—ã–º –ª–æ—Å–æ—Å–µ–º, –Ω–µ–∂–Ω—ã–º —Ç–≤–æ—Ä–æ–∂–Ω—ã–º —Å—ã—Ä–æ–º –∏ —Å–ø–µ–ª—ã–º –∞–≤–æ–∫–∞–¥–æ."},
        {id:2, cat:'rolls', name:"–ö–∞–ª–∏—Ñ–æ—Ä–Ω–∏—è", price:750, meta:"250–≥ ‚Ä¢ 8—à—Ç", img:"https://images.unsplash.com/photo-1559466273-d95e72debaf8?w=500", desc:"–°–Ω–µ–∂–Ω—ã–π –∫—Ä–∞–±, –∏–∫—Ä–∞ —Ç–æ–±–∏–∫–æ, –æ–≥—É—Ä–µ—Ü –∏ —è–ø–æ–Ω—Å–∫–∏–π –º–∞–π–æ–Ω–µ–∑."},
        {id:3, cat:'rolls', name:"–ß–µ—Ä–Ω—ã–π –î—Ä–∞–∫–æ–Ω", price:990, meta:"310–≥ ‚Ä¢ 8—à—Ç", img:"https://images.unsplash.com/photo-1590947132387-155cc02f3212?w=500", desc:"–ö–æ–ø—á–µ–Ω—ã–π —É–≥–æ—Ä—å, —Å–æ—É—Å —É–Ω–∞–≥–∏, –∫—É–Ω–∂—É—Ç –∏ –∫—Ä–µ–≤–µ—Ç–∫–∞ —Ç–µ–º–ø—É—Ä–∞."},
        {id:4, cat:'sets', name:"–°–µ—Ç –Ø–∫—É–¥–∑–∞", price:4500, meta:"1.2–∫–≥ ‚Ä¢ 40—à—Ç", img:"https://images.unsplash.com/photo-1583623025817-d180a2221d0a?w=500", desc:"–ù–∞–±–æ—Ä-–±–µ—Å—Ç—Å–µ–ª–ª–µ—Ä –¥–ª—è –±–æ–ª—å—à–æ–π –∫–æ–º–ø–∞–Ω–∏–∏."},
        {id:6, cat:'drinks', name:"–ú–∞—Ç—á–∞ –õ–∞—Ç—Ç–µ", price:350, meta:"350–º–ª", img:"https://images.unsplash.com/photo-1536496070141-8440ae99de43?w=500", desc:"–ù–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π —è–ø–æ–Ω—Å–∫–∏–π —á–∞–π —Å –∫–æ–∫–æ—Å–æ–≤—ã–º –º–æ–ª–æ–∫–æ–º."}
    ];

    if(tg.initDataUnsafe?.user) {
        document.getElementById('user-name').innerText = tg.initDataUnsafe.user.first_name;
        if(tg.initDataUnsafe.user.photo_url) document.getElementById('u-avatar').src = tg.initDataUnsafe.user.photo_url;
    }

    function render() {
        const grid = document.getElementById('grid');
        grid.innerHTML = '';
        const filtered = products.filter(p => currentCategory === 'all' || p.cat === currentCategory);
        
        filtered.forEach((p, idx) => {
            const el = document.createElement('div');
            el.className = 'item';
            el.style.animationDelay = (idx * 0.05) + 's';
            el.onclick = () => showItem(p.id);
            el.innerHTML = `
                <img src="${p.img}" class="item-img">
                <div style="margin-top:10px">
                    <div class="item-title">${p.name}</div>
                    <div style="font-size:10px; color:var(--gray); margin-bottom:8px;">${p.meta}</div>
                    <div class="item-price">${p.price} ‚ÇΩ <div class="add-badge">+</div></div>
                </div>`;
            grid.appendChild(el);
        });
    }

    function setCat(cat, el) {
        currentCategory = cat;
        document.querySelectorAll('.tab-item').forEach(i => i.classList.remove('active'));
        el.classList.add('active');
        render();
        tg.HapticFeedback.impactOccurred('light');
    }

    function showItem(id) {
        curProduct = products.find(p => p.id === id);
        document.getElementById('d-img').src = curProduct.img;
        document.getElementById('d-title').innerText = curProduct.name;
        document.getElementById('d-desc').innerText = curProduct.desc;
        document.getElementById('d-meta').innerText = curProduct.meta;
        document.getElementById('d-price-big').innerText = curProduct.price + ' ‚ÇΩ';
        document.getElementById('details-sheet').classList.add('active');
        document.getElementById('overlay').classList.add('active');
    }

    function addToCart() {
        cart.push({...curProduct, cartId: Date.now()});
        updateCart();
        closeAll();
        tg.HapticFeedback.notificationOccurred('success');
    }

    function updateCart() {
        document.getElementById('c-count').innerText = cart.length;
        document.getElementById('c-count').style.display = cart.length > 0 ? 'flex' : 'none';
        document.getElementById('total-val').innerText = cart.reduce((s, i) => s + i.price, 0);
    }

    function openCart() {
        const list = document.getElementById('cart-items');
        list.innerHTML = cart.length === 0 ? '<p style="text-align:center;color:var(--gray)">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>' : 
            cart.map((i, idx) => `
            <div class="cart-item" style="display:flex; justify-content:space-between; align-items:center; padding:15px 0;">
                <div><b>${i.name}</b><br><small style="color:var(--gray)">${i.price} ‚ÇΩ</small></div>
                <div style="color:var(--accent); font-weight:700;" onclick="removeFromCart(${idx})">–£–¥–∞–ª–∏—Ç—å</div>
            </div>`).join('');
        document.getElementById('cart-sheet').classList.add('active');
        document.getElementById('overlay').classList.add('active');
    }

    function removeFromCart(idx) {
        cart.splice(idx, 1);
        updateCart();
        openCart();
        tg.HapticFeedback.impactOccurred('medium');
    }

    function addAddon(name, price, emoji) {
        cart.push({name: emoji + ' ' + name, price: price, cartId: Date.now()});
        updateCart();
        openCart();
        tg.HapticFeedback.impactOccurred('light');
    }

    function closeAll() {
        document.querySelectorAll('.sheet').forEach(s => s.classList.remove('active'));
        document.getElementById('overlay').classList.remove('active');
    }

    function sendOrder() {
        const addr = document.getElementById('address').value;
        if(!addr || cart.length === 0) return tg.showAlert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∫–æ—Ä–∑–∏–Ω—É –∏ –∞–¥—Ä–µ—Å!");
        tg.sendData(JSON.stringify({items: cart, address: addr}));
    }

    render();
</script>
</body>
</html>