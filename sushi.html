<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: #0b0b0d;
            --card-bg: #151518;
            --accent: #ff3b30;
            --text: #ffffff;
            --glass: rgba(255, 255, 255, 0.05);
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            margin: 0; padding: 15px;
            padding-bottom: 120px;
        }

        /* –®–∞–ø–∫–∞ —Å –ø—Ä–æ—Ñ–∏–ª–µ–º */
        .header-profile {
            display: flex; align-items: center; gap: 12px;
            margin-bottom: 25px; padding: 5px;
        }
        .user-avatar { width: 45px; height: 45px; border-radius: 50%; border: 2px solid var(--accent); }

        /* –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ */
        .categories {
            display: flex; overflow-x: auto; gap: 10px;
            margin-bottom: 25px; scrollbar-width: none;
        }
        .categories::-webkit-scrollbar { display: none; }
        .cat-btn {
            background: var(--card-bg); border: 1px solid var(--glass);
            color: white; padding: 10px 20px; border-radius: 100px;
            white-space: nowrap; font-size: 14px; font-weight: 600;
        }
        .cat-btn.active { background: var(--accent); border-color: var(--accent); }

        /* –°–µ—Ç–∫–∞ */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .card {
            background: var(--card-bg); border-radius: 24px; padding: 12px;
            border: 1px solid rgba(255,255,255,0.03); position: relative;
        }
        .card img { width: 100%; border-radius: 18px; }
        .price { color: var(--accent); font-weight: 800; font-size: 18px; margin-top: 5px; }
        
        .add-badge {
            background: var(--accent); color: white; border-radius: 10px;
            padding: 4px 8px; font-size: 12px; font-weight: bold;
            position: absolute; top: 18px; right: 18px;
        }

        /* –ú–æ–¥–∞–ª–∫–∞ */
        #modal {
            position: fixed; bottom: -100%; left: 0; right: 0;
            background: rgba(20, 20, 23, 0.98); backdrop-filter: blur(20px);
            border-radius: 30px 30px 0 0; padding: 25px; z-index: 1000;
            transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        #modal.active { bottom: 0; }
        .overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); display: none; z-index: 999; }

        input {
            width: 100%; background: #222; border: 1px solid #333;
            padding: 16px; border-radius: 14px; color: white;
            margin-top: 10px; box-sizing: border-box; font-size: 16px;
        }

        /* –ö–Ω–æ–ø–∫–∞ –∑–∞–∫–∞–∑–∞ */
        .cart-btn {
            position: fixed; bottom: 25px; left: 15px; right: 15px;
            background: linear-gradient(90deg, #ff3b30, #ff6b30);
            border: none; border-radius: 20px; padding: 20px;
            color: white; font-weight: 800; display: none;
            justify-content: space-between; z-index: 1001;
            box-shadow: 0 10px 30px rgba(255, 59, 48, 0.3);
        }
    </style>
</head>
<body>

<div class="header-profile">
    <img id="avatar" class="user-avatar" src="https://via.placeholder.com/45">
    <div>
        <div id="u-name" style="font-weight: 800;">–ì–æ—Å—Ç—å</div>
        <div style="font-size: 12px; color: #888;">–°–µ–≥–æ–¥–Ω—è –æ—Ç–ª–∏—á–Ω—ã–π –¥–µ–Ω—å –¥–ª—è —Å—É—à–∏!</div>
    </div>
</div>

<div class="categories" id="cats">
    <button class="cat-btn active" onclick="filter('all')">–í—Å–µ</button>
    <button class="cat-btn" onclick="filter('rolls')">üç£ –†–æ–ª–ª—ã</button>
    <button class="cat-btn" onclick="filter('sets')">üç± –°–µ—Ç—ã</button>
    <button class="cat-btn" onclick="filter('drinks')">üçπ –ù–∞–ø–∏—Ç–∫–∏</button>
</div>

<div class="grid" id="grid"></div>

<div class="overlay" id="overlay" onclick="closeModal()"></div>
<div id="modal">
    <div id="modal-content">
        <img id="m-img" style="width:100%; border-radius:20px; margin-bottom:15px;">
        <h2 id="m-title" style="margin:0"></h2>
        <p id="m-desc" style="color:#888; margin: 15px 0; line-height:1.5;"></p>
        <button class="cat-btn active" style="width:100%; padding:15px;" onclick="addToCart()">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
    </div>
    <div id="form" style="display:none">
        <h2>–î–æ—Å—Ç–∞–≤–∫–∞</h2>
        <input type="text" id="addr" placeholder="–ê–¥—Ä–µ—Å">
        <input type="tel" id="tel" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω">
        <button class="cat-btn active" style="width:100%; padding:15px; margin-top:15px;" onclick="confirmOrder()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–∫–∞–∑</button>
    </div>
</div>

<button class="cart-btn" id="cart" onclick="openForm()">
    <span>–û–§–û–†–ú–ò–¢–¨ –ó–ê–ö–ê–ó</span>
    <span id="total-val">0 ‚ÇΩ</span>
</button>

<script>
    let tg = window.Telegram.WebApp;
    let cart = [];
    let cur = null;
    
    const products = [
        {id:1, cat:'rolls', name:"–§–∏–ª–∞–¥–µ–ª—å—Ñ–∏—è", price:890, desc:"–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Ä–æ–ª–ª —Å –Ω–µ–∂–Ω—ã–º –ª–æ—Å–æ—Å–µ–º –∏ —Å–ª–∏–≤–æ—á–Ω—ã–º —Å—ã—Ä–æ–º.", img:"https://images.unsplash.com/photo-1579871494447-9811cf80d66c?w=400"},
        {id:2, cat:'rolls', name:"–ö–∞–ª–∏—Ñ–æ—Ä–Ω–∏—è", price:750, desc:"–°–Ω–µ–∂–Ω—ã–π –∫—Ä–∞–±, –∞–≤–æ–∫–∞–¥–æ –∏ –∏–∫—Ä–∞ —Ç–æ–±–∏–∫–æ.", img:"https://images.unsplash.com/photo-1559466273-d95e72debaf8?w=400"},
        {id:3, cat:'sets', name:"–°–µ—Ç –°–∞–º—É—Ä–∞–π", price:2500, desc:"–ë–æ–ª—å—à–æ–π –Ω–∞–±–æ—Ä –¥–ª—è –∫–æ–º–ø–∞–Ω–∏–∏ –∏–∑ 32 —Ä–æ–ª–ª–æ–≤.", img:"https://images.unsplash.com/photo-1583623025817-d180a2221d0a?w=400"},
        {id:4, cat:'drinks', name:"–ú–∞—Ç—á–∞ –õ–∞—Ç—Ç–µ", price:350, desc:"–¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–π —è–ø–æ–Ω—Å–∫–∏–π —á–∞–π —Å –º–æ–ª–æ–∫–æ–º.", img:"https://images.unsplash.com/photo-1536496070141-8440ae99de43?w=400"}
    ];

    tg.expand();
    if(tg.initDataUnsafe?.user) {
        document.getElementById('u-name').innerText = tg.initDataUnsafe.user.first_name;
        if(tg.initDataUnsafe.user.photo_url) document.getElementById('avatar').src = tg.initDataUnsafe.user.photo_url;
    }

    function render(c = 'all') {
        const g = document.getElementById('grid');
        g.innerHTML = '';
        products.filter(p => c === 'all' || p.cat === c).forEach(p => {
            g.innerHTML += `<div class="card" onclick="openDetails(${p.id})">
                <img src="${p.img}">
                <div style="font-weight:600; margin-top:10px;">${p.name}</div>
                <div class="price">${p.price} ‚ÇΩ</div>
            </div>`;
        });
    }

    function filter(c) {
        document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
        render(c);
    }

    function openDetails(id) {
        cur = products.find(p => p.id === id);
        document.getElementById('m-img').src = cur.img;
        document.getElementById('m-title').innerText = cur.name;
        document.getElementById('m-desc').innerText = cur.desc;
        document.getElementById('modal-content').style.display = 'block';
        document.getElementById('form').style.display = 'none';
        document.getElementById('modal').classList.add('active');
        document.getElementById('overlay').style.display = 'block';
        tg.HapticFeedback.impactOccurred('medium');
    }

    function addToCart() {
        cart.push(cur);
        const total = cart.reduce((s, p) => s + p.price, 0);
        document.getElementById('total-val').innerText = total + ' ‚ÇΩ';
        document.getElementById('cart').style.display = 'flex';
        closeModal();
        tg.HapticFeedback.notificationOccurred('success');
    }

    function openForm() {
        document.getElementById('modal-content').style.display = 'none';
        document.getElementById('form').style.display = 'block';
        document.getElementById('modal').classList.add('active');
        document.getElementById('overlay').style.display = 'block';
    }

    function closeModal() {
        document.getElementById('modal').classList.remove('active');
        document.getElementById('overlay').style.display = 'none';
    }

    function confirmOrder() {
        const a = document.getElementById('addr').value;
        const t = document.getElementById('tel').value;
        if(!a || !t) return tg.showAlert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ!");
        tg.sendData(JSON.stringify({items: cart, total: cart.reduce((s, p) => s + p.price, 0), address: a, phone: t}));
    }

    render();
</script>
</body>
</html>