<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
  <meta name="color-scheme" content="dark">
  <title>YAKUZA –°—É—à–∏</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8/hammer.min.js"></script>
  <style>
  :root{
    --bg:#000000;
    --card:#111113;
    --text:#ffffff;
    --text-gray:#8e8e93;
    --accent:#ff2d55;
    --accent-light:#b1ff5c;
    --glass:rgba(255,255,255,0.05);
    --border:rgba(255,255,255,0.08);
    --shadow:0 8px 32px rgba(255,45,85,0.25);
    --radius:24px;
  }
  *{box-sizing:border-box;-webkit-font-smoothing:antialiased;}
  body{margin:0;font-family:-apple-system,BlinkMacSystemFont,'SF Pro Display','Helvetica Neue',sans-serif;background:var(--bg);color:var(--text);overflow-x:hidden;scroll-behavior:smooth;}

  /* —à–∞–ø–∫–∞ */
  .header{position:fixed;top:0;left:0;right:0;z-index:1000;background:var(--glass);backdrop-filter:blur(20px);border-bottom:0.5px solid var(--border);padding:10px 20px;display:flex;align-items:center;justify-content:space-between;}
  .logo{font-weight:900;font-size:22px;letter-spacing:-1px;}
  .cart-icon{position:relative;width:38px;height:38px;border-radius:50%;background:#222;display:grid;place-items:center;font-size:20px;border:none;color:var(--text);}
  .cart-badge{position:absolute;top:-2px;right:-2px;background:var(--accent);color:#fff;font-size:10px;min-width:18px;height:18px;border-radius:9px;display:none;align-items:center;justify-content:center;font-weight:800;border:2px solid var(--bg);}

  /* –ø—Ä–æ–º–æ */
  .hero-slider{position:relative;width:calc(100% - 40px);height:180px;margin:20px auto;border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow);}
  .hero-slide{position:absolute;inset:0;opacity:0;transition:opacity 1s ease;}
  .hero-slide img{width:100%;height:100%;object-fit:cover;}
  .hero-slide.active{opacity:1;}
  .hero-text{position:absolute;bottom:16px;left:20px;right:20px;font-size:18px;font-weight:800;text-shadow:0 1px 4px rgba(0,0,0,.7);}

  /* –∫–æ–Ω—Ç–µ–Ω—Ç */
  .main-content{padding-top:80px;padding-bottom:calc(70px + env(safe-area-inset-bottom,0));}

  /* grid */
  .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:14px;padding:0 20px;}
  .item{background:var(--card);border-radius:var(--radius);padding:12px;border:1px solid var(--border);box-shadow:var(--shadow);position:relative;animation:slideUp .5s ease backwards;transition:transform .25s,background .25s;}
  .item:active{transform:scale(0.96);background:#1a1a1c;}
  .item-img{width:100%;aspect-ratio:1/1;border-radius:18px;object-fit:cover;margin-bottom:10px;}
  .badge{position:absolute;top:18px;right:18px;background:var(--accent);color:#fff;font-size:9px;font-weight:900;padding:4px 8px;border-radius:8px;z-index:2;}
  .price-row{margin-top:8px;border-top:1px solid rgba(255,255,255,.06);padding-top:8px;text-align:right;}
  .p-val{font-size:15px;font-weight:800;}

  /* –Ω–∏–∂–Ω–∏–µ —Ç–∞–±—ã */
  .bottom-tabs{position:fixed;bottom:0;left:0;right:0;height:calc(60px + env(safe-area-inset-bottom,0));background:var(--glass);backdrop-filter:blur(20px);border-top:0.5px solid var(--border);display:flex;z-index:1001;padding-bottom:env(safe-area-inset-bottom,0);}
  .bottom-tab{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;background:none;border:none;color:var(--text-gray);font-size:11px;font-weight:600;transition:color .2s;}
  .bottom-tab.active{color:var(--accent-light);}
  .bottom-icon{font-size:22px;line-height:1;}

  /* —à—Ç–æ—Ä–∫–∏ */
  .overlay{position:fixed;inset:0;background:rgba(0,0,0,.65);backdrop-filter:blur(8px);opacity:0;visibility:hidden;z-index:1500;transition:.3s;}
  .overlay.active{opacity:1;visibility:visible;}
  .sheet{position:fixed;bottom:0;left:0;right:0;background:var(--card);border-radius:32px 32px 0 0;padding:24px 20px 40px;max-height:85vh;overflow-y:auto;z-index:2000;transform:translateY(105%);transition:transform .5s cubic-bezier(.19,1,.22,1);box-shadow:var(--shadow);}
  .sheet.active{transform:translateY(0);}
  .sheet-handle{width:40px;height:4px;background:#333;border-radius:10px;margin:0 auto 15px;}
  .btn-main{width:100%;background:var(--accent-light);color:#000;border:none;padding:20px;border-radius:22px;font-weight:800;font-size:16px;margin-top:10px;transition:transform .15s,background .15s;}
  .btn-main:active{transform:scale(0.97);background:#c4ff4c;}
  .input-style{width:100%;background:#1c1c1e;border:1px solid #333;padding:18px;border-radius:18px;color:var(--text);margin-bottom:15px;outline:none;transition:border-color .2s;}
  .input-style:focus{border-color:var(--accent);}
  .pay-selector{display:flex;background:#222;border-radius:16px;padding:4px;margin:20px 0;}
  .pay-opt{flex:1;text-align:center;padding:12px;font-size:12px;font-weight:700;border-radius:12px;color:var(--text-gray);transition:background .2s,color .2s;}
  .pay-opt.active{background:#333;color:var(--accent-light);}

  /* –∫—Ä—É—Ç–∞—è –∫–æ—Ä–∑–∏–Ω–∞: +/- –∫–æ–ª-–≤–æ + –ø—Ä–æ–º–æ + –∏—Ç–æ–≥ */
  .cart-item{display:flex;align-items:center;gap:12px;background:#1c1c1e;border-radius:20px;padding:14px;margin-bottom:10px;animation:slideUp .3s ease;}
  .cart-info{flex:1;}
  .cart-controls{display:flex;align-items:center;gap:8px;}
  .cart-btn{width:28px;height:28px;border-radius:50%;background:#333;color:var(--text);border:none;font-size:16px;display:grid;place-items:center;}
  .cart-qty{font-weight:800;font-size:15px;width:24px;text-align:center;}
  .cart-price{font-weight:800;font-size:15px;}
  .cart-remove{margin-left:auto;color:var(--accent);font-weight:800;font-size:13px;}
  .promo-row{display:flex;gap:8px;margin:15px 0;}
  .promo-input{flex:1;background:#1c1c1e;border:1px solid #333;border-radius:12px;padding:12px;color:var(--text);font-size:14px;}
  .promo-btn{background:#222;color:var(--accent-light);border:none;border-radius:12px;padding:0 16px;font-weight:700;}
  .total-row{display:flex;justify-content:space-between;align-items:center;margin-top:15px;font-size:17px;font-weight:800;}
  .delivery-free{color:var(--accent-light);font-size:13px;margin-top:4px;}
  @keyframes slideUp{from{transform:translateY(30px);opacity:0}to{transform:translateY(0);opacity:1}}
  </style>
</head>
<body>

<!-- —à–∞–ø–∫–∞ -->
<div class="header">
  <div class="logo">YAKUZA</div>
  <button class="cart-icon" onclick="openCart()">
    üõí
    <span class="cart-badge" id="cart-badge">0</span>
  </button>
</div>

<div class="main-content">
  <!-- –ø—Ä–æ–º–æ -->
  <div class="hero-slider" id="hero-slider"></div>
  <!-- —Ç–æ–≤–∞—Ä—ã -->
  <div class="grid" id="grid"></div>
</div>

<!-- –Ω–∏–∂–Ω–∏–µ —Ç–∞–±—ã -->
<nav class="bottom-tabs">
  <button class="bottom-tab active" onclick="switchTab('rolls')">
    <span class="bottom-icon">üç£</span>
    <span>–†–æ–ª–ª—ã</span>
  </button>
  <button class="bottom-tab" onclick="switchTab('wok')">
    <span class="bottom-icon">üçú</span>
    <span>–í–æ–∫–∏</span>
  </button>
  <button class="bottom-tab" onclick="switchTab('snacks')">
    <span class="bottom-icon">ü•ü</span>
    <span>–ó–∞–∫—É—Å–∫–∏</span>
  </button>
  <button class="bottom-tab" onclick="switchTab('drinks')">
    <span class="bottom-icon">ü•§</span>
    <span>–ù–∞–ø–∏—Ç–∫–∏</span>
  </button>
</nav>

<!-- —à—Ç–æ—Ä–∫–∏ -->
<div class="overlay" id="overlay" onclick="closeAll()"></div>
<div id="details-sheet" class="sheet">
  <div class="sheet-handle"></div>
  <img id="d-img" style="width:100%;border-radius:22px;height:260px;object-fit:cover;">
  <h2 id="d-title" style="margin:20px 0 5px;font-size:26px;font-weight:900;"></h2>
  <p id="d-meta" style="color:var(--text-gray);font-size:14px;margin-bottom:15px;"></p>
  <p id="d-desc" style="color:#bbb;line-height:1.5;font-size:15px;margin-bottom:20px;"></p>
  <button class="btn-main" onclick="addToCartFromDetails()">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
</div>

<div id="cart-sheet" class="sheet">
  <div class="sheet-handle"></div>
  <h2 style="margin:0 0 20px;font-weight:900;">–í–∞—à –∑–∞–∫–∞–∑</h2>
  <div id="cart-items"></div>
  <div id="cart-empty" style="text-align:center;padding:30px;color:var(--text-gray);display:none;">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>

  <div id="cart-ui">
    <!-- –ø—Ä–æ–º–æ-–∫–æ–¥ -->
    <div class="promo-row">
      <input type="text" class="promo-input" id="promo-input" placeholder="–ü—Ä–æ–º–æ–∫–æ–¥">
      <button class="promo-btn" onclick="applyPromo()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
    </div>

    <!-- —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã -->
    <div class="pay-selector">
      <div class="pay-opt active" onclick="setPay('cash',this)">–ù–∞–ª–∏—á–Ω—ã–µ</div>
      <div class="pay-opt" onclick="setPay('card',this)">–ö–∞—Ä—Ç–æ–π</div>
      <div class="pay-opt" onclick="setPay('online',this)">–û–Ω–ª–∞–π–Ω</div>
    </div>

    <!-- –∏—Ç–æ–≥ -->
    <div class="total-row">
      <span>–ò—Ç–æ–≥–æ</span>
      <span id="total-val">0‚ÇΩ</span>
    </div>
    <div class="delivery-free" id="delivery-free"></div>

    <!-- –∞–¥—Ä–µ—Å -->
    <input type="text" id="address" class="input-style" placeholder="–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏">

    <button class="btn-main" onclick="sendOrder()">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
  </div>
</div>

<script>
  let tg = window.Telegram.WebApp; tg.expand();
  let cart = [], curProd = null, payMethod = 'cash', currentTab = 'rolls';
  let promoApplied = false;

  const menu = {
    rolls: [
      {id:1,name:"–ú–µ—á—Ç–∞ –∫–æ—Ç–∞",price:1530,meta:"32 —à—Ç | 1.1 –∫–≥",img:"https://images.unsplash.com/photo-1579871494447-9811cf80d66c?w=600",desc:"–§–∏–ª–∞–¥–µ–ª—å—Ñ–∏—è –æ–≥—É—Ä–µ—Ü, –§–∏–ª–∞–¥–µ–ª—å—Ñ–∏—è –±–µ–∫–æ–Ω, –¢–µ–º–ø—É—Ä–∞ —á–∏–∫–µ–Ω, –¢–µ–º–ø—É—Ä–∞ —Ç–∞–º–∞–≥–æ –ª–æ—Å–æ—Å—å.",tag:"–•–ò–¢"},
      {id:2,name:"–°–µ—Ç –ó–∏–º–Ω–∏–π",price:1945,meta:"64 —à—Ç | 2.2 –∫–≥",img:"https://images.unsplash.com/photo-1583623025817-d180a2221d0a?w=600",desc:"–û–≥—Ä–æ–º–Ω—ã–π —Å–µ—Ç –¥–ª—è –±–æ–ª—å—à–æ–π –∫–æ–º–ø–∞–Ω–∏–∏.",tag:"NEW"},
      {id:3,name:"–§–∏–ª–∞–¥–µ–ª—å—Ñ–∏—è",price:650,meta:"8 —à—Ç | 280 –≥",img:"https://images.unsplash.com/photo-1553621042-f6e147245754?w=600",desc:"–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Ä–æ–ª–ª —Å–æ —Å–≤–µ–∂–∏–º –ª–æ—Å–æ—Å–µ–º.",tag:""},
      {id:4,name:"–ö–∞–ª–∏—Ñ–æ—Ä–Ω–∏—è",price:590,meta:"8 —à—Ç | 250 –≥",img:"https://images.unsplash.com/photo-1559466273-d95e72debaf8?w=600",desc:"–°–Ω–µ–∂–Ω—ã–π –∫—Ä–∞–±, –æ–≥—É—Ä–µ—Ü –∏ –∏–∫—Ä–∞ —Ç–æ–±–∏–∫–æ.",tag:""}
    ],
    wok: [
      {id:5,name:"–ö—É—Ä–∏—Ü–∞ –≤–æ–∫",price:490,meta:"320 –≥",img:"https://images.unsplash.com/photo-1625938146369-adc83368bda7?w=600",desc:"–ö—É—Ä–∏—Ü–∞, –æ–≤–æ—â–∏, —Å–æ—É—Å —Ç–µ—Ä–∏—è–∫–∏.",tag:""},
      {id:6,name:"–ì–æ–≤—è–¥–∏–Ω–∞ –≤–æ–∫",price:590,meta:"320 –≥",img:"https://images.unsplash.com/photo-1625938146369-adc83368bda7?w=600",desc:"–ì–æ–≤—è–¥–∏–Ω–∞, –æ–≤–æ—â–∏, —Å–æ—É—Å —á–∏–ª–∏.",tag:""}
    ],
    snacks: [
      {id:7,name:"–ì–µ–¥–∑–∞",price:290,meta:"6 —à—Ç",img:"https://images.unsplash.com/photo-1617093727343-374698b1b08d?w=600",desc:"–ö—É—Ä–∏—Ü–∞, —Å–≤–∏–Ω–∏–Ω–∞, –æ–≤–æ—â–∏.",tag:""},
      {id:8,name:"–°–ø–∞–π—Å–∏ —ç–¥–∞–º–∞–º–µ",price:190,meta:"120 –≥",img:"https://images.unsplash.com/photo-1609501676725-7186f017a4b7?w=600",desc:"–û—Å—Ç—Ä—ã–π —Å–æ—É—Å, –∫—É–Ω–∂—É—Ç.",tag:""}
    ],
    drinks: [
      {id:9,name:"Coca-Cola",price:120,meta:"0.5 –ª",img:"https://images.unsplash.com/photo-1625772299848-391b6a87d281?w=600",desc:"–•–æ–ª–æ–¥–Ω–∞—è, –≥–∞–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è.",tag:""},
      {id:10,name:"–§RESH-–ª–∏–º–æ–Ω–∞–¥",price:180,meta:"0.4 –ª",img:"https://images.unsplash.com/photo-1625772299848-391b6a87d281?w=600",desc:"–õ–∏–º–æ–Ω, –º—è—Ç–∞, –ª—ë–¥.",tag:"NEW"}
    ]
  };

  const heroImages = [
    {img:"https://images.unsplash.com/photo-1553621042-f6e147245754?w=1200",txt:"–ü–æ–¥–∞—Ä–æ–∫ –∫ –∑–∞–∫–∞–∑—É –æ—Ç 2000‚ÇΩ"},
    {img:"https://images.unsplash.com/photo-1579584425555-c3ce17fd4351?w=1200",txt:"–°–∫–∏–¥–∫–∞ -15% –Ω–∞ —Å–∞–º–æ–≤—ã–≤–æ–∑"},
    {img:"https://images.unsplash.com/photo-1611143669185-af224c5e3252?w=1200",txt:"–ù–æ–≤—ã–π —Å–µ—Ç ¬´–°–∞–º—É—Ä–∞–π¬ª"}
  ];

  let heroIndex = 0;
  function initHeroSlider(){
    const slider = document.getElementById('hero-slider');
    slider.innerHTML = heroImages.map((h,i)=>`
      <div class="hero-slide ${i===0?'active':''}">
        <img src="${h.img}" alt="">
        <div class="hero-text">${h.txt}</div>
      </div>`).join('');
    setInterval(()=>{
      const slides = slider.querySelectorAll('.hero-slide');
      slides[heroIndex].classList.remove('active');
      heroIndex = (heroIndex + 1) % slides.length;
      slides[heroIndex].classList.add('active');
    }, 3000);
  }

  function switchTab(tab){
    currentTab = tab;
    document.querySelectorAll('.bottom-tab').forEach(t=>t.classList.remove('active'));
    event.currentTarget.classList.add('active');
    render();
  }

  function render(){
    const items = menu[currentTab] || [];
    document.getElementById('grid').innerHTML = items.map((p,i)=>`
      <div class="item" style="animation-delay:${i*0.1}s" onclick="showDetails(${p.id})">
        ${p.tag?`<div class="badge">${p.tag}</div>`:''}
        <img src="${p.img}" class="item-img">
        <div style="font-weight:800;font-size:15px">${p.name}</div>
        <div style="font-size:11px;color:var(--text-gray)">${p.meta}</div>
        <div class="price-row">
          <span class="p-val">${p.price}‚ÇΩ</span>
        </div>
      </div>`).join('');
  }

  function showDetails(id){
    const all = Object.values(menu).flat();
    curProd = all.find(p=>p.id===id);
    ['d-img','d-title','d-meta','d-desc'].forEach((s,i)=>{
      document.getElementById(s).src = i===0?curProd.img:'';
      if(i>0) document.getElementById(s).innerText = [curProd.name,curProd.meta,curProd.desc][i-1];
    });
    openSheet('details-sheet');
    tg.HapticFeedback.impactOccurred('medium');
  }

  function addToCartFromDetails(){
    const exist = cart.find(x=>x.id===curProd.id);
    if(exist) exist.qty = (exist.qty||1)+1;
    else cart.push({...curProd, qty:1});
    updateCartUI(); closeAll();
    tg.HapticFeedback.notificationOccurred('success');
  }

  function changeQty(id,delta){
    const item = cart.find(x=>x.id===id);
    if(!item) return;
    item.qty = Math.max(1, (item.qty||1)+delta);
    if(item.qty===0) cart=cart.filter(x=>x.id!==id);
    updateCartUI(); openCart();
  }

  function removeItem(id){ cart=cart.filter(x=>x.id!==id); updateCartUI(); openCart(); }

  function applyPromo(){
    const code = document.getElementById('promo-input').value.trim().toUpperCase();
    if(code==='YAKUZA'){
      promoApplied = true;
      tg.showAlert('–ü—Ä–æ–º–æ–∫–æ–¥ –ø—Ä–∏–º–µ–Ω—ë–Ω! –î–æ—Å—Ç–∞–≤–∫–∞ –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è.');
    }else{
      tg.showAlert('–ü—Ä–æ–º–æ–∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω');
    }
    updateCartUI();
  }

  function updateCartUI(){
    const c=cart.reduce((s,i)=>s+(i.qty||1),0);
    const badge=document.getElementById('cart-badge');
    badge.innerText=c; badge.style.display=c?'flex':'none';

    const subtotal = cart.reduce((s,i)=>s+i.price*(i.qty||1),0);
    const freeDeliveryThreshold = 900;
    let delivery = 0;
    if(!promoApplied && subtotal<freeDeliveryThreshold) delivery = 150;

    const total = subtotal+delivery;
    document.getElementById('total-val').innerText = total+'‚ÇΩ';

    const freeEl = document.getElementById('delivery-free');
    if(delivery===0) freeEl.innerText='–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞';
    else freeEl.innerText=`–î–æ—Å—Ç–∞–≤–∫–∞ 150‚ÇΩ (–±–µ—Å–ø–ª–∞—Ç–Ω–æ –æ—Ç ${freeDeliveryThreshold}‚ÇΩ)`;

    const list=document.getElementById('cart-items');
    if(cart.length===0){
      document.getElementById('cart-empty').style.display='block';
      document.getElementById('cart-ui').style.display='none';
      list.innerHTML='';
    }else{
      document.getElementById('cart-empty').style.display='none';
      document.getElementById('cart-ui').style.display='block';
      list.innerHTML=cart.map(i=>`
        <div class="cart-item">
          <div class="cart-info"><b>${i.name}</b><br><small>${i.price}‚ÇΩ</small></div>
          <div class="cart-controls">
            <button class="cart-btn" onclick="changeQty(${i.id},-1)">‚àí</button>
            <span class="cart-qty">${i.qty||1}</span>
            <button class="cart-btn" onclick="changeQty(${i.id},1)">+</button>
          </div>
          <span class="cart-price">${i.price*(i.qty||1)}‚ÇΩ</span>
          <span class="cart-remove" onclick="removeItem(${i.id})">–£–¥–∞–ª–∏—Ç—å</span>
        </div>`).join('');
    }
  }

  function setPay(m,el){ payMethod=m; document.querySelectorAll('.pay-opt').forEach(o=>o.classList.remove('active')); el.classList.add('active'); }

  function closeAll(){ document.querySelectorAll('.sheet').forEach(s=>s.classList.remove('active')); document.getElementById('overlay').classList.remove('active'); }

  function openSheet(id){ document.getElementById(id).classList.add('active'); document.getElementById('overlay').classList.add('active'); }

  function sendOrder(){
    if(cart.length===0) return;
    const addr = document.getElementById('address').value.trim();
    if(!addr) return tg.showAlert("–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏!");
    tg.sendData(JSON.stringify({
      order:cart,
      address:addr,
      payment:payMethod,
      promo:promoApplied,
      total:document.getElementById('total-val').innerText
    }));
  }

  document.querySelectorAll('.sheet').forEach(sh=>{
    const h = new Hammer(sh); h.on('swipedown', closeAll);
  });

  initHeroSlider();
  render();
  updateCartUI();
</script>
</body>
</html>