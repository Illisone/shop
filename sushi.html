<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="style_sushi.css">
</head>
<body>

<div class="header">
    <div class="brand">
        <div class="logo-circle" style="color: white;">Y</div>
        <div style="font-weight: 800; font-size: 18px;">YAKUZA</div>
    </div>
    <div style="display: flex; gap: 12px; align-items: center;">
        <div class="cart-btn" onclick="openCart()" style="cursor:pointer; position:relative;">
            <span style="font-size: 22px;">üõí</span>
            <div id="c-count" style="position:absolute; top:-5px; right:-5px; background:var(--accent); color:white; font-size:10px; width:18px; height:18px; border-radius:50%; display:none; align-items:center; justify-content:center;">0</div>
        </div>
        <img id="u-avatar" style="width: 36px; height: 36px; border-radius: 50%; border: 1px solid var(--glass-border);" src="https://via.placeholder.com/36">
    </div>
</div>

<div class="main-content">
    <div class="promo-container">
        <div class="promo-card">
            <div class="promo-text">
                <h4>–°–µ—Ç –º–µ—Å—è—Ü–∞</h4>
                <p>–°–∫–∏–¥–∫–∞ 20% –Ω–∞ –≤—Å–µ —Å–µ—Ç—ã<br>–¥–æ –∫–æ–Ω—Ü–∞ –Ω–µ–¥–µ–ª–∏!</p>
            </div>
            <span style="font-size: 50px; position:absolute; right:10px; bottom:10px; opacity:0.3;">üç±</span>
        </div>
        <div class="promo-card dark">
            <div class="promo-text">
                <h4>–ü–æ–¥–∞—Ä–æ–∫!</h4>
                <p>–†–æ–ª–ª ¬´–ö–∞–ª–∏—Ñ–æ—Ä–Ω–∏—è¬ª –ø—Ä–∏<br>–∑–∞–∫–∞–∑–µ –æ—Ç 2000‚ÇΩ</p>
            </div>
            <span style="font-size: 50px; position:absolute; right:10px; bottom:10px; opacity:0.3;">üéÅ</span>
        </div>
    </div>

    <h3 style="margin: 0 20px 15px; font-weight: 800;">–ú–µ–Ω—é</h3>
    <div class="grid" id="grid"></div>
</div>

<div class="tab-bar">
    <div class="tab-item active" onclick="setCat('all', this)">–í—Å–µ</div>
    <div class="tab-item" onclick="setCat('rolls', this)">–†–æ–ª–ª—ã</div>
    <div class="tab-item" onclick="setCat('sets', this)">–°–µ—Ç—ã</div>
</div>

<div class="overlay" id="overlay" onclick="closeAll()"></div>

<div id="details-sheet" class="sheet">
    <div style="width: 40px; height: 5px; background: rgba(255,255,255,0.2); border-radius: 10px; margin: -10px auto 20px;"></div>
    <img id="d-img" style="width:100%; border-radius:24px; height:240px; object-fit:cover;">
    <div style="display:flex; justify-content:space-between; align-items: center; margin: 20px 0;">
        <h2 id="d-title" style="margin:0;"></h2>
        <span id="d-price-big" style="color:var(--accent); font-weight:800; font-size:24px;"></span>
    </div>
    <p id="d-desc" style="color:var(--gray); line-height:1.6; margin-bottom:25px;"></p>
    <button class="btn-order" onclick="addToCart()">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
</div>

<div id="cart-sheet" class="sheet">
    <div style="width: 40px; height: 5px; background: rgba(255,255,255,0.2); border-radius: 10px; margin: -10px auto 20px;"></div>
    <h2 style="margin: 0 0 20px;">–ö–æ—Ä–∑–∏–Ω–∞</h2>
    <div id="cart-items" style="max-height: 250px; overflow-y: auto;"></div>
    <input type="text" id="address" placeholder="–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏" style="width:100%; background:rgba(255,255,255,0.05); border:1px solid var(--glass-border); padding:16px; border-radius:18px; color:white; margin:15px 0; box-sizing:border-box;">
    <button class="btn-order" onclick="sendOrder()">–ó–∞–∫–∞–∑–∞—Ç—å ‚Ä¢ <span id="total-val">0</span>‚ÇΩ</button>
</div>

<script>
    let tg = window.Telegram.WebApp;
    tg.expand();

    let cart = [];
    let curProduct = null;
    let currentCategory = 'all';

    const products = [
        {id:1, cat:'rolls', name:"–§–∏–ª–∞–¥–µ–ª—å—Ñ–∏—è", price:890, meta:"280–≥", img:"https://images.unsplash.com/photo-1579871494447-9811cf80d66c?w=500", desc:"–ü—Ä–µ–º–∏–∞–ª—å–Ω—ã–π –ª–æ—Å–æ—Å—å, —Å–ª–∏–≤–æ—á–Ω—ã–π —Å—ã—Ä –∏ –∞–≤–æ–∫–∞–¥–æ."},
        {id:2, cat:'rolls', name:"–ö–∞–ª–∏—Ñ–æ—Ä–Ω–∏—è", price:750, meta:"250–≥", img:"https://images.unsplash.com/photo-1559466273-d95e72debaf8?w=500", desc:"–ö—Ä–∞–±, –∏–∫—Ä–∞ —Ç–æ–±–∏–∫–æ –∏ –æ–≥—É—Ä–µ—Ü."},
        {id:4, cat:'sets', name:"–°–µ—Ç –Ø–∫—É–¥–∑–∞", price:4500, meta:"1.2–∫–≥", img:"https://images.unsplash.com/photo-1583623025817-d180a2221d0a?w=500", desc:"–û–≥—Ä–æ–º–Ω—ã–π —Å–µ—Ç –¥–ª—è –±–æ–ª—å—à–æ–π –∫–æ–º–ø–∞–Ω–∏–∏."}
    ];

    function render() {
        const grid = document.getElementById('grid');
        grid.innerHTML = products.filter(p => currentCategory === 'all' || p.cat === currentCategory).map(p => `
            <div class="item" onclick="showItem(${p.id})">
                <img src="${p.img}" class="item-img">
                <div style="font-weight:700; font-size:15px;">${p.name}</div>
                <div style="font-size:11px; color:var(--gray); margin: 4px 0 8px;">${p.meta}</div>
                <div style="font-weight:800; color:var(--accent); display:flex; justify-content:space-between; align-items:center;">
                    ${p.price} ‚ÇΩ <div style="background:var(--accent); color:white; width:22px; height:22px; border-radius:8px; display:flex; align-items:center; justify-content:center;">+</div>
                </div>
            </div>`).join('');
    }

    function showItem(id) {
        curProduct = products.find(p => p.id === id);
        document.getElementById('d-img').src = curProduct.img;
        document.getElementById('d-title').innerText = curProduct.name;
        document.getElementById('d-desc').innerText = curProduct.desc;
        document.getElementById('d-price-big').innerText = curProduct.price + ' ‚ÇΩ';
        document.getElementById('details-sheet').classList.add('active');
        document.getElementById('overlay').classList.add('active');
        tg.HapticFeedback.impactOccurred('light');
    }

    function addToCart() {
        cart.push(curProduct);
        updateCart();
        closeAll();
        tg.HapticFeedback.notificationOccurred('success');
    }

    function updateCart() {
        document.getElementById('c-count').innerText = cart.length;
        document.getElementById('c-count').style.display = cart.length > 0 ? 'flex' : 'none';
        document.getElementById('total-val').innerText = cart.reduce((s, i) => s + i.price, 0);
    }

    function openCart() {
        const list = document.getElementById('cart-items');
        list.innerHTML = cart.length === 0 ? '<p style="text-align:center;color:var(--gray)">–ü—É—Å—Ç–æ</p>' : 
            cart.map((i, idx) => `
            <div style="display:flex; justify-content:space-between; padding:12px; background:rgba(255,255,255,0.04); border-radius:15px; margin-bottom:8px;">
                <div><b>${i.name}</b><br><small>${i.price} ‚ÇΩ</small></div>
                <div style="color:var(--accent); font-weight:700;" onclick="cart.splice(${idx},1); updateCart(); openCart();">–£–¥–∞–ª–∏—Ç—å</div>
            </div>`).join('');
        document.getElementById('cart-sheet').classList.add('active');
        document.getElementById('overlay').classList.add('active');
    }

    function closeAll() {
        document.querySelectorAll('.sheet').forEach(s => s.classList.remove('active'));
        document.getElementById('overlay').classList.remove('active');
    }

    function setCat(cat, el) {
        currentCategory = cat;
        document.querySelectorAll('.tab-item').forEach(i => i.classList.remove('active'));
        el.classList.add('active');
        render();
    }

    if(tg.initDataUnsafe?.user?.photo_url) document.getElementById('u-avatar').src = tg.initDataUnsafe.user.photo_url;
    render();
</script>
</body>
</html>